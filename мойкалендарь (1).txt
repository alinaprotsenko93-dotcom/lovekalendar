LoveTracker/
 â”œâ”€ app/
 â”‚   â”œâ”€ src/main/java/com/example/lovetracker/
 â”‚   â”‚   â”œâ”€ data/
 â”‚   â”‚   â”‚   â”œâ”€ LoveDay.kt         // ĞœĞ¾Ğ´ĞµĞ»ÑŒ
 â”‚   â”‚   â”‚   â”œâ”€ LoveDayDao.kt      // DAO
 â”‚   â”‚   â”‚   â””â”€ LoveDatabase.kt    // Room Ğ±Ğ°Ğ·Ğ°
 â”‚   â”‚   â”œâ”€ ui/
 â”‚   â”‚   â”‚   â”œâ”€ MainScreen.kt      // Ğ­ĞºÑ€Ğ°Ğ½ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ¼ĞµÑ‚Ğ¾Ğº
 â”‚   â”‚   â”‚   â”œâ”€ CalendarScreen.kt  // ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
 â”‚   â”‚   â”‚   â””â”€ Theme.kt           // Ğ¦Ğ²ĞµÑ‚Ğ°, ÑˆÑ€Ğ¸Ñ„Ñ‚Ñ‹
 â”‚   â”‚   â”œâ”€ widget/
 â”‚   â”‚   â”‚   â”œâ”€ LoveWidget.kt      // Ğ’Ğ¸Ğ´Ğ¶ĞµÑ‚ Glance
 â”‚   â”‚   â”‚   â””â”€ LoveWidgetReceiver.kt
 â”‚   â”‚   â”œâ”€ LoveViewModel.kt       // ViewModel
 â”‚   â”‚   â””â”€ MainActivity.kt        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
 â”‚   â””â”€ AndroidManifest.xml
 â””â”€ build.gradle
@Entity
data class LoveDay(
    @PrimaryKey val date: String,
    val wasIntimate: Boolean = false,
    val hadExperiment: Boolean = false,
    val pleasureReceived: Boolean = false,
    val partnerComment: String? = null,
    val missedByPartner: Boolean = false,
    val freezeUsed: Boolean = false,
    val taskCompleted: Boolean = false
)
@Dao
interface LoveDayDao {
    @Query("SELECT * FROM LoveDay ORDER BY date ASC")
    suspend fun getAllDays(): List<LoveDay>

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertDay(day: LoveDay)

    @Query("DELETE FROM LoveDay")
    suspend fun clearAll()
}
@Database(entities = [LoveDay::class], version = 1)
abstract class LoveDatabase : RoomDatabase() {
    abstract fun loveDayDao(): LoveDayDao

    companion object {
        @Volatile private var INSTANCE: LoveDatabase? = null
        fun getDatabase(context: Context): LoveDatabase {
            return INSTANCE ?: synchronized(this) {
                val instance = Room.databaseBuilder(
                    context.applicationContext,
                    LoveDatabase::class.java,
                    "love_db"
                ).build()
                INSTANCE = instance
                instance
            }
        }
    }
}
class LoveViewModel(application: Application) : AndroidViewModel(application) {
    private val dao = LoveDatabase.getDatabase(application).loveDayDao()

    private val _days = MutableStateFlow<List<LoveDay>>(emptyList())
    val days: StateFlow<List<LoveDay>> = _days

    private val _streak = MutableStateFlow(0)
    val streak: StateFlow<Int> = _streak

    init { loadDays() }

    fun loadDays() = viewModelScope.launch {
        val allDays = dao.getAllDays().sortedBy { it.date }
        _days.value = allDays
        calculateStreak(allDays)
    }

    private fun calculateStreak(allDays: List<LoveDay>) {
        var currentStreak = 0
        var freezeCount = 0
        for (day in allDays) {
            if (day.wasIntimate || day.freezeUsed) currentStreak++
            else {
                freezeCount++
                if (freezeCount >= 3) {
                    viewModelScope.launch { dao.clearAll() }
                    currentStreak = 0
                    break
                }
            }
        }
        _streak.value = currentStreak
    }

    fun markDay(
        wasIntimate: Boolean,
        hadExperiment: Boolean,
        pleasureReceived: Boolean,
        partnerComment: String? = null,
        missedByPartner: Boolean = false,
        taskCompleted: Boolean = false,
        freezeUsed: Boolean = false
    ) {
        val date = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault()).format(Date())
        val day = LoveDay(
            date, wasIntimate, hadExperiment, pleasureReceived,
            partnerComment, missedByPartner, freezeUsed, taskCompleted
        )
        viewModelScope.launch {
            dao.insertDay(day)
            loadDays()
        }
    }

    fun calculateKisses(): Int {
        return _days.value.sumOf {
            var total = 0
            if (it.wasIntimate) total += 10
            if (it.hadExperiment) total += 50
            if (it.pleasureReceived) total += 50
            if (it.taskCompleted) total += 10
            total
        }
    }
}
@Composable
fun MainScreen(viewModel: LoveViewModel = viewModel()) {
    val days by viewModel.days.collectAsState()
    val kisses = viewModel.calculateKisses()

    var wasIntimate by remember { mutableStateOf(false) }
    var hadExperiment by remember { mutableStateOf(false) }
    var pleasureReceived by remember { mutableStateOf(false) }
    var comment by remember { mutableStateOf("") }

    Column(modifier = Modifier.padding(16.dp)) {
        Text("ğŸ’‹ ĞŸĞ¾Ñ†ĞµĞ»ÑƒĞ¹Ñ‡Ğ¸ĞºĞ¾Ğ²: $kisses", color = Color.Red)
        Spacer(Modifier.height(8.dp))

        Button(onClick = { wasIntimate = !wasIntimate }) {
            Text(if (wasIntimate) "ĞÑ‚Ğ¼ĞµÑ‚ĞºĞ°: Ğ‘Ñ‹Ğ»Ğ¾ ğŸ”¥" else "ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ½ÑŒ Ğ¸Ğ½Ñ‚Ğ¸Ğ¼Ğ½Ğ¾ÑÑ‚Ğ¸")
        }
        Spacer(Modifier.height(8.dp))
        Button(onClick = { hadExperiment = !hadExperiment }) {
            Text(if (hadExperiment) "Ğ‘Ñ‹Ğ» ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚ ğŸŒŸ" else "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚")
        }
        Spacer(Modifier.height(8.dp))
        Button(onClick = { pleasureReceived = !pleasureReceived }) {
            Text(if (pleasureReceived) "ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾ ÑƒĞ´Ğ¾Ğ²Ğ¾Ğ»ÑŒÑÑ‚Ğ²Ğ¸Ğµ â¤ï¸" else "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ´Ğ¾Ğ²Ğ¾Ğ»ÑŒÑÑ‚Ğ²Ğ¸Ğµ")
        }
        Spacer(Modifier.height(8.dp))
        OutlinedTextField(
            value = comment,
            onValueChange = { comment = it },
            label = { Text("ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ°") }
        )
        Spacer(Modifier.height(8.dp))
        Button(onClick = {
            viewModel.markDay(wasIntimate, hadExperiment, pleasureReceived, comment)
            wasIntimate = false
            hadExperiment = false
            pleasureReceived = false
            comment = ""
        }) { Text("Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ½ÑŒ â¤ï¸") }
        Spacer(Modifier.height(16.dp))
        Text("Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ½ĞµĞ¹:", color = Color.DarkRed)
        days.forEach { day ->
            val emoji = when {
                day.wasIntimate && day.taskCompleted -> "ğŸ”¥âœ¨"
                day.wasIntimate -> "ğŸ”¥"
                day.freezeUsed -> "â„ï¸"
                else -> "ğŸ’¤"
            }
            Text("${day.date}: $emoji ${day.partnerComment ?: ""}")
        }
    }
}
@Composable
fun CalendarScreen(viewModel: LoveViewModel = viewModel()) {
    val days by viewModel.days.collectAsState()
    LazyColumn(modifier = Modifier.padding(16.dp)) {
        items(days) { day ->
            val emoji = when {
                day.wasIntimate && day.taskCompleted -> "ğŸ”¥âœ¨"
                day.wasIntimate -> "ğŸ”¥"
                day.freezeUsed -> "â„ï¸"
                else -> "ğŸ’¤"
            }
            Text("${day.date}: $emoji ${day.partnerComment ?: ""}", color = Color.Red)
        }
    }
}
class LoveWidget : GlanceAppWidget() {
    @Composable
    override fun Content() {
        val db = Room.databaseBuilder(
            LocalContext.current,
            LoveDatabase::class.java, "love_db"
        ).build()
        val dao = db.loveDayDao()
        val days = runBlocking { dao.getAllDays() }
        val streak = days.count { it.wasIntimate || it.freezeUsed }

        Column(
            modifier = Modifier
                .fillMaxSize()
                .background(Color(0xFFFFC0CB))
                .padding(16.dp)
        ) {
            Text("ğŸ”¥ Ğ£Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼: $streak Ğ´Ğ½ĞµĞ¹", color = Color.Red)
        }
    }
}
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        val viewModel: LoveViewModel = ViewModelProvider(this)[LoveViewModel::class.java]

        setContent {
            MaterialTheme {
                Column {
                    MainScreen(viewModel)
                    Spacer(Modifier.height(16.dp))
                    CalendarScreen(viewModel)
                }
            }
        }
    }
}
